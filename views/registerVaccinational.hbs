<div class="container">
    <h1>Đăng ký tiêm chủng</h1>
    <div>Đăng ký thông tin tiêm chủng để tiết kiệm thời gian khi đến làm thủ tục tại quầy Lễ tân cho Quý Khách hàng, việc đăng ký thông tin tiêm chủng chưa hỗ trợ đặt lịch hẹn chính xác theo giờ.
    </div><br/>
    <div>
    <form method="post" action="/ticket/add" enctype="multipart/form-data">
        <div class="row">
            <div class="col-md-6">
                <div class="form-group">
                    <h4 for="genderInject">Lựa chọn hình thức đăng ký (*)</h4>
                    <div class="custom-control custom-radio">
                        <input type="radio" class="custom-control-input" id="0" name="radio-option" value="0" onclick="handleClickOption(this);" checked>
                        <label class="custom-control-label" for="me">Bản thân</label>
                    </div>
                    <div class="custom-control custom-radio mb-3">
                        <input type="radio" class="custom-control-input" id="1" name="radio-option" value="1" onclick="handleClickOption(this);">
                        <label class="custom-control-label" for="guest">Đăng ký hộ</label>
                    </div>
                </div>
            </div>
        </div><br />
        <div id="info-customer" style="display: none;">
             <h4>THÔNG TIN NGƯỜI TIÊM</h4>
            <div class="row">
                <div class="col-md-6 form-group">
                    <label for="nameInject">Họ tên người tiêm (*)</label>
                    <input type="input" class="form-control" id="nameInject" name="nameInject">
                </div>
                <div class="col-md-6 form-group">
                    <label for="birtInject">Ngày sinh người tiêm (*)</label>
                    <input type="datetime-local" class="form-control" id="birtInject" name="birtInject">
                </div>
            </div><br />
            <div class="row">
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="genderInject">Giới tính (*)</label>
                        <div class="custom-control custom-radio">
                            <input type="radio" class="custom-control-input" id="customControlValidation2" name="radio-gender" value="0">
                            <label class="custom-control-label" for="customControlValidation2">Nam</label>
                        </div>
                        <div class="custom-control custom-radio mb-3">
                            <input type="radio" class="custom-control-input" id="customControlValidation3" name="radio-gender" value="1">
                            <label class="custom-control-label" for="customControlValidation3">Nữ</label>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <label for="inputCustomer">Mã khách hàng (Nếu có)</label>
                    <input type="input" class="form-control" id="inputCustomer" name="inputCustomer">
                </div>
            </div><br />
            <div class="row">
                <div class="col-md-4">
                    <label for="inputCity">Tỉnh thành (*)</label>
                    <select class="form-control" for="inputCity"  id="citySelect" name="inputCity" onchange="choosedCity()">
                        <option>Chọn Tỉnh</option>
                        {{#each locations}}
                        <option value="{{this.code}}">{{this.name}}</option>
                        {{/each}}
                    </select>
                </div>
                <div class="col-md-4">
                    <label for="inputDistrict">Quận huyện (*)</label>
                    <select class="form-control" for="inputDistrict" id="district" name="inputDistrict" onchange="choosedDistrict()">
                    </select>
                </div>
                <div class="col-md-4">
                    <label for="inputWard">Phường xã (*)</label>
                    <select class="form-control" for="inputWard" id="ward" name="inputWard">
                    </select>
                </div>
            </div><br />
            <div class="row">
                <div class="col-md-12">
                    <label for="street">Số nhà, tên đường (*)</label>
                    <input type="input" class="form-control" id="street" name="street">
                </div>
            </div><br />
        </div>
        <div id="rel-person">
            <h4>THÔNG TIN NGƯỜI THÂN</h4>
            <div class="row">
                <div class="col-md-12">
                    <label for="nameFamily">Họ tên người liên hệ (*)</label>
                    <input type="input" class="form-control" id="nameFamily" name="nameFamily">
                </div>
            </div><br />
            <div class="row">
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="relationship">Mối quan hệ với người tiêm (*)</label>
                        <select class="form-control" id="relationship" name="relationship">
                            <option value="1">Con</option>
                            <option value="2">Cha</option>
                            <option value="3">Mẹ</option>
                            <option value="4">Chồng</option>
                            <option value="5">Anh</option>
                            <option value="6">Chị</option>
                            <option value="7">Em</option>
                            <option value="8">Ông</option>
                            <option value="9">Bà</option>
                            <option value="10">Họ hàng</option>
                            <option value="11">Khác</option>
                        </select>
                    </div>
                </div>
                <div class="col-md-6">
                    <label for="inputPhoneFamily">Số điện thoại người liên hệ (*)</label>
                    <input type="input" class="form-control" id="inputPhoneFamily" name="inputPhoneFamily">
                </div>
            </div><br />
        </div>
            <h4>THÔNG TIN DỊCH VỤ</h4>
            <div class="row">
                <div class="col-md-12">
                    <div class="form-group">
                        <label for="inputAddress">Loại vắc xin muốn đăng ký (*)</label>
                        <div class="custom-control custom-radio">
                            <input type="radio" class="custom-control-input" id="0" value="0" name="radio-stacked" onclick="handleClick(this);">
                            <label class="custom-control-label" for="customControlValidation2">Vắc xin gói</label>
                        </div>
                        <div class="custom-control custom-radio mb-3">
                            <input type="radio" class="custom-control-input" id="1" value="1" name="radio-stacked" onclick="handleClick(this);">
                            <label class="custom-control-label" for="customControlValidation3">Vắc xin lẻ</label>
                        </div>
                    </div>
                </div>
            </div>
            <div id="vaccineListGroup" style="display: none;">
            </div>
            <div id="vaccineListSingle" style="display: none;">
            </div> <br />
            <div class="row">
                <div class="col-md-12">
                    <label for="branchWant">Trung tâm VNVC mong muốn tiêm (*)</label>
                    <select class="form-control" id="branchWant" name="branchWant">
                        <option>Chọn cơ sở</option>
                        {{#each branchs}}
                        <option value="{{this._id}}">{{this.name}}</option>
                        {{/each}}
                    </select>
                </div>
            </div><br />
            <div class="row">
                <div class="col-md-6">
                    <label for="dateInject">Ngày mong muốn tiêm (*)</label>
                    <input type="datetime-local" class="form-control" id="dateInject" name="dateInject">
                </div>
            </div><br />
            <button type="submit" class="btn btn-success">Hoàn thành đăng ký</button>
        </form>
        
    </div>
</div>
<script>
    let cityCode = 1
    function choosedCity() {
        let idCity =  document.getElementById("citySelect").value;
        fetch('https://provinces.open-api.vn/api/d/')
            .then(response => response.json())
            .then(data => {
                let districts = data.filter(item => item.province_code == idCity)
                let districtsHTML = ""
                for (let district of districts) {
                    districtsHTML += `<option value="${district.code}">${district.name}</option>`
                }
                document.getElementById("district").innerHTML = districtsHTML
            });
        
    }

    function choosedDistrict() {
        let idDistrict =  document.getElementById("district").value;
        fetch('https://provinces.open-api.vn/api/w/')
            .then(response => response.json())
            .then(data => {
                let wards = data.filter(item => item.district_code == idDistrict)
                let wardsHTML = ""
                for (let ward of wards) {
                    wardsHTML += `<option value="${ward.code}">${ward.name}</option>`
                }
                document.getElementById("ward").innerHTML = wardsHTML
            });
    }

    function handleClick(event) {
        if(event.value === "0"){
            document.getElementById('vaccineListGroup').style.display = "block"
            document.getElementById('vaccineListSingle').style.display = "none"
            fetch('http://localhost:3000/category/listAndVaccineListIsGroup')
            .then(response => response.json())
            .then(data => {
               let groupHTML = ""
               for (let category of data) {
                    let title = `
                    <div class="row" ><b>${category.name}</b></div>
                    <div class="row"> `
                    let content = ""
                    for (let vaccine of category.vacciniesList){
                        content += `
                            <div class="col-md-4" style="border-style: ridge;">
                                <input type="checkbox" value="${vaccine._id}" name="vaccineChoosed"/>
                                <div>${vaccine.name} - ${vaccine.price} VND</div>
                            </div>
                        `
                    }
                    let footer = `</div>`
                    let HTML = title + content + footer
                    groupHTML += HTML
               }
                document.getElementById("vaccineListGroup").innerHTML = groupHTML
            });
        }else{
            document.getElementById('vaccineListSingle').style.display = "block"
            document.getElementById('vaccineListGroup').style.display = "none"
            fetch('http://localhost:3000/vaccine/getByType/1')
            .then(response => response.json())
            .then(data => {
               let groupHTML = `<div class="row">`
               for (let vaccine of data) {
                    groupHTML += `
                             <div class="col-md-4" style="border-style: ridge;">
                                <input type="checkbox" value="${vaccine._id}" name="vaccineChoosed"/>
                                <div>${vaccine.name} - ${vaccine.price} VND</div>
                            </div>
                    `
               }
               groupHTML += `</div>`
                document.getElementById("vaccineListSingle").innerHTML = groupHTML
            });
        
        }
    }

    function handleClickOption(event) {
        if(event.value === "0") {
            document.getElementById('info-customer').style.display = "none"
            document.getElementById('rel-person').style.display = "block"
        }else{
             document.getElementById('info-customer').style.display = "block"
             document.getElementById('rel-person').style.display = "none"
        }
    }
</script>